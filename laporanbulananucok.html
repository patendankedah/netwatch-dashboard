<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan Bulanan</title>

<style>
:root{
  --bg:#f1f5f9;
  --card:#ffffff;
  --grid:#9aa0a6;
  --text:#202124;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* HEADER */

.app-header{
  position:sticky;
  top:0;
  z-index:100;
  background:linear-gradient(135deg,#1e3a8a,#2563eb);
  color:#fff;
  padding:10px 12px;
}

.app-title{
  font-size:14px;
  font-weight:600;
  margin-bottom:6px;
}

select{
  width:100%;
  padding:8px 10px;
  border-radius:8px;
  border:none;
  font-size:13px;
  outline:none;
}

/* CONTENT */

.container{
  padding:8px;
}

.card{
  background:var(--card);
  border-radius:10px;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
  overflow:hidden;
}

/* TABLE */

.table-wrapper{
  overflow:auto;
  max-height:calc(100vh - 120px);
}

table{
  border-collapse:collapse;
  min-width:100%;
  width:max-content;
  font-size:13px;
  border:1.5px solid var(--grid);
}

td{
  border:1.2px solid var(--grid);
  padding:2px 6px;
  white-space:nowrap;
  vertical-align:middle;
}

/* HEADER ROW */

tr:first-child td{
  background:#f8f9fa;
  font-weight:600;
  position:sticky;
  top:0;
  z-index:10;
  border-bottom:2px solid #5f6368;
}

/* MESSAGE */

.message{
  text-align:center;
  padding:30px 10px;
  font-size:13px;
  color:#6b7280;
}

/* MOBILE */

@media(max-width:600px){
  table{
    font-size:12px;
  }

  td{
    padding:2px 5px;
  }
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="app-header">
  <div class="app-title" id="title">Laporan Bulanan</div>
  <select id="sheetSelect">
    <option value="" selected disabled>Pilih Periode Laporan</option>
  </select>
</div>

<!-- CONTENT -->
<div class="container">
  <div class="card">
    <div class="table-wrapper">
      <div id="message" class="message">
        Silakan pilih periode laporan
      </div>
      <table id="table"></table>
    </div>
  </div>
</div>

<script>

/* API URL */
const API_URL = "https://script.google.com/macros/s/AKfycbzeT0pWrx4UjsyxNIlE60sW5Q4cuNvELvgdtBEmyPX-W_HXsNATarCamaxXfsr6_Q52_w/exec";

/* ELEMENT */

const table = document.getElementById("table");
const title = document.getElementById("title");
const select = document.getElementById("sheetSelect");
const message = document.getElementById("message");

/* MONTH MAP */

const bulanMap = {
  "01":"Januari","02":"Februari","03":"Maret","04":"April",
  "05":"Mei","06":"Juni","07":"Juli","08":"Agustus",
  "09":"September","10":"Oktober","11":"November","12":"Desember"
};

function formatLabel(sheet){
  if(sheet.length !== 6) return sheet;
  return (bulanMap[sheet.substr(0,2)] || sheet) + " " + sheet.substr(2);
}

/* LOAD SHEET LIST */

async function loadSheetList(){

  try{
    const res = await fetch(API_URL + "?mode=list");
    const data = await res.json();

    select.innerHTML = '<option value="" selected disabled>Pilih Periode Laporan</option>';

    data.sheets.forEach(name=>{
      const opt=document.createElement("option");
      opt.value=name;
      opt.textContent=formatLabel(name);
      select.appendChild(opt);
    });

  }catch(e){
    message.textContent="Gagal memuat periode";
  }
}

/* CHANGE EVENT */

select.addEventListener("change",()=>{

  if(!select.value){
    table.innerHTML="";
    message.style.display="block";
    title.textContent="Laporan Bulanan";
    return;
  }

  loadSheet(select.value);
});

/* LOAD DATA */

async function loadSheet(sheet){

  message.style.display="block";
  message.textContent="Memuat laporan...";
  table.innerHTML="";
  title.textContent="Memuat laporan...";

  try{
    const res = await fetch(API_URL + "?sheet="+sheet);
    const data = await res.json();

    if(data.error){
      message.textContent=data.message;
      title.textContent="Laporan Bulanan";
      return;
    }

    title.textContent="Periode: "+formatLabel(data.sheetName);

    renderTable(data);
    message.style.display="none";

  }catch(e){
    message.textContent="Gagal memuat data";
    title.textContent="Laporan Bulanan";
  }
}

/* RENDER A1:Q25 */

function renderTable(data){

  table.innerHTML="";

  for(let r=0;r<25;r++){

    const tr=document.createElement("tr");
    tr.style.height=data.rowHeights[r]+"px";

    for(let c=0;c<17;c++){

      const td=document.createElement("td");

      td.textContent=data.values[r][c] || "";
      td.style.width=data.colWidths[c]+"px";
      td.style.background=data.backgrounds[r][c];
      td.style.color=data.fontColors[r][c];

      tr.appendChild(td);
    }

    table.appendChild(tr);
  }
}

/* INIT */

loadSheetList();

</script>

</body>
</html>
