<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Netwatch Pro</title>

<style>
body {
  margin: 0;
  font-family: system-ui, Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
}

.header {
  padding: 14px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.summary {
  padding: 0 16px 12px;
  display: flex;
  gap: 8px;
}

.sum {
  flex: 1;
  background: #020617;
  padding: 12px;
  border-radius: 12px;
  text-align: center;
}

.filter {
  padding: 0 16px 12px;
  display: flex;
  gap: 8px;
}

.filter button {
  flex: 1;
  padding: 8px;
  border-radius: 10px;
  border: none;
  background: #020617;
  color: #e5e7eb;
  font-weight: 600;
}

.filter button.active {
  background: #1e293b;
}

.list {
  padding: 0 16px 16px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.card {
  background: #020617;
  border-radius: 14px;
  padding: 12px;
  border-left: 4px solid transparent;
}

.card.up { border-color: #22c55e; }

.card.down {
  border-color: #ef4444;
  background: rgba(239,68,68,0.12);
  animation: blink 1.6s infinite;
}

@keyframes blink {
  0%,100% { opacity:1 }
  50% { opacity:.75 }
}

/* mode tenang malam */
body.night .card.down {
  animation: none;
}

.row {
  display: grid;
  grid-template-columns: 1fr 22px;
  align-items: center;
  gap: 8px;
}

.ip {
  font-weight: 600;
}

.dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
}

.dot.up { background:#22c55e }
.dot.down { background:#ef4444 }

.meta {
  font-size: 12px;
  opacity: .85;
  margin-top: 4px;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.badge {
  font-size: 11px;
  padding: 2px 6px;
  border-radius: 6px;
  background: #7c2d12;
}

.detail {
  display: none;
  margin-top: 8px;
  font-size: 12px;
  opacity: .9;
}

.card.open .detail {
  display: block;
}
</style>
</head>

<body>

<div class="header">
  <b>FIXNET</b>
  <small id="time"></small>
</div>

<div class="summary">
  <div class="sum">üü¢ UP<br><b id="up">0</b></div>
  <div class="sum">üî¥ DOWN<br><b id="down">0</b></div>
</div>

<div class="filter">
  <button onclick="setFilter('ALL')" class="active">ALL</button>
  <button onclick="setFilter('UP')">UP</button>
  <button onclick="setFilter('DOWN')">DOWN</button>
</div>

<div id="list" class="list"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwMbQFx6il185k2zkoElxgNMitigU7snwvpb--KHO919Bx4-vJYIpnznaHv0M4JcWG48A/exec";
const CURRENT = "FIXNET";
const PINNED = ["192.168.1.1"]; // IP prioritas

let FILTER = "ALL";

function setFilter(v){
  FILTER = v;
  document.querySelectorAll(".filter button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
  fetchData();
}

function formatDuration(ms){
  const m = Math.floor(ms/60000);
  if(m < 60) return `${m} menit`;
  return `${Math.floor(m/60)} jam ${m%60} mnt`;
}

function isNight(){
  const h = new Date().getHours();
  return h >= 22 || h < 6;
}

async function fetchData(){
  document.body.classList.toggle("night", isNight());

  const res = await fetch(`${SCRIPT_URL}?mode=list&sheet=${CURRENT}`);
  const data = await res.json();

  let up=0, down=0;
  const list = document.getElementById("list");
  list.innerHTML = "";

  let rows = data.slice(1).filter(r=>r[0]);
  rows.sort((a,b)=> PINNED.includes(b[0]) - PINNED.includes(a[0]));

  rows.forEach(r=>{
    const ip = r[0];
    const mac = r[1];
    const comment = r[2];
    const status = (r[4]||"UP").toUpperCase();
    const last = new Date(r[5]);

    if(status==="UP") up++; else down++;

    if(FILTER!=="ALL" && FILTER!==status) return;

    let badge="";
    if(status==="DOWN"){
      const dur = Date.now()-last;
      if(dur>7200000) badge="üö®";
      else if(dur>1800000) badge="‚ö†Ô∏è";
    }

    list.innerHTML+=`
    <div class="card ${status.toLowerCase()}" onclick="this.classList.toggle('open')">
      <div class="row">
        <div class="ip">${PINNED.includes(ip)?"‚≠ê ":""}${ip}</div>
        <span class="dot ${status.toLowerCase()}"></span>
      </div>
      <div class="meta">
        <span>${status}</span>
        ${status==="DOWN"?`<span>${formatDuration(Date.now()-last)}</span>`:""}
        ${badge?`<span class="badge">${badge}</span>`:""}
      </div>
      <div class="detail">
        MAC: ${mac}<br>
        Info: ${comment}
      </div>
    </div>`;
  });

  document.getElementById("up").innerText = up;
  document.getElementById("down").innerText = down;
}

setInterval(()=>{
  document.getElementById("time").innerText = new Date().toLocaleTimeString();
},1000);

fetchData();
setInterval(fetchData,10000);
</script>

</body>
</html>
