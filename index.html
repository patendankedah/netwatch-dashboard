<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>BACOK WIFI - TV MODE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: #000;
  color: #fff;
}

.container {
  padding: 20px;
}

h1 {
  text-align: center;
  font-size: 34px;
  margin-bottom: 10px;
}

.server-select {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin: 30px 0;
}

.server-select button,
.back-btn {
  font-size: 20px;
  padding: 12px 25px;
  background: #222;
  color: #fff;
  border: 2px solid #444;
  border-radius: 10px;
  cursor: pointer;
}

.server-select button:hover,
.back-btn:hover {
  background: #444;
}

.back-btn {
  display: none;
  margin-bottom: 15px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  background: #111;
  padding: 16px;
  font-size: 20px;
}

td {
  padding: 14px;
  font-size: 20px;
  border-bottom: 1px solid #222;
}

.status {
  text-align: center;
}

.dot {
  display: inline-block;
  width: 20px;
  height: 20px;
  border-radius: 50%;
}

.up { background: #00ff00; }
.down {
  background: #ff3333;
  animation: blink 1s infinite;
}

@keyframes blink {
  50% { opacity: 0.3; }
}

tbody {
  display: block;
  max-height: 65vh;
  overflow-y: auto;
}

thead, tr {
  display: table;
  width: 100%;
  table-layout: fixed;
}

.footer {
  text-align: center;
  margin-top: 15px;
  color: #aaa;
  font-size: 14px;
}
</style>
</head>

<body>
<div class="container">
  <h1>ðŸ“¡ BACOK WIFI â€“ MONITORING</h1>

  <!-- PILIH SERVER -->
  <div class="server-select" id="serverSelect">
    <button onclick="selectServer('Sheet1')">OK 1</button>
    <button onclick="selectServer('Sheet2')">SERVER 2</button>
    <button onclick="selectServer('Sheet3')">SERVER 3</button>
    <button onclick="selectServer('Sheet4')">SERVER 4</button>
	<button onclick="selectServer('Sheet5')">SERVER 5</button>
  </div>

  <!-- BACK -->
  <button class="back-btn" id="backBtn" onclick="backToMenu()">â¬… Kembali pilih server</button>

  <!-- TABLE -->
  <table id="dataTable" style="display:none">
    <thead>
      <tr>
        <th>Node</th>
        <th>Status</th>
        <th>Update</th>
      </tr>
    </thead>
    <tbody id="statusBody">
      <tr><td colspan="3">Loading...</td></tr>
    </tbody>
  </table>

  <div class="footer">
    Auto refresh 10 detik â€¢ TV Mode
  </div>
</div>

<script>
const API_BASE = "https://script.google.com/macros/s/AKfycbxWdDlnie9XwxUaokH3t2_ZkE9pi988yWhSu6oD2daqslDeFOLD2sWYjCOqElojvYqt/exec";

let currentSheet = null;
let refreshTimer = null;
let scrollTimer = null;

function selectServer(sheet) {
  currentSheet = sheet;

  document.getElementById("serverSelect").style.display = "none";
  document.getElementById("dataTable").style.display = "table";
  document.getElementById("backBtn").style.display = "inline-block";

  loadData();
  refreshTimer = setInterval(loadData, 10000);
}

function backToMenu() {
  currentSheet = null;

  clearInterval(refreshTimer);
  clearInterval(scrollTimer);

  document.getElementById("serverSelect").style.display = "flex";
  document.getElementById("dataTable").style.display = "none";
  document.getElementById("backBtn").style.display = "none";

  document.getElementById("statusBody").innerHTML =
    "<tr><td colspan='3'>Pilih server di atas</td></tr>";
}

async function loadData() {
  if (!currentSheet) return;

  try {
    const res = await fetch(`${API_BASE}?sheet=${currentSheet}`);
    const data = await res.json();
    renderTable(data);
  } catch {
    document.getElementById("statusBody").innerHTML =
      "<tr><td colspan='3' style='color:red'>Gagal ambil data</td></tr>";
  }
}

function renderTable(data) {
  const tbody = document.getElementById("statusBody");
  tbody.innerHTML = "";

  data.forEach(d => {
    const date = d.updated_at
      ? new Date(d.updated_at).toLocaleString("id-ID", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit"
        })
      : "-";

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${d.comment}</td>
      <td class="status">
        <span class="dot ${d.status === 'up' ? 'up' : 'down'}"></span>
      </td>
      <td>${date}</td>
    `;
    tbody.appendChild(tr);
  });

  // auto scroll
  let pos = 0;
  clearInterval(scrollTimer);
  scrollTimer = setInterval(() => {
    pos += 1;
    tbody.scrollTop = pos;
    if (tbody.scrollTop + tbody.clientHeight >= tbody.scrollHeight) {
      pos = 0;
    }
  }, 80);
}

// double click fullscreen
document.addEventListener("dblclick", () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
  }
});
</script>
</body>
</html>
